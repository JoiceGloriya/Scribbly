<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scribbly - Note-taking app</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
    <h1> <img src="images/notes.jpeg">Notes</h1>
    <button class="btn"> <img src="images/edit.jpeg">Create Notes</button>
    <div class="notes-container">
        <!-- <p contenteditable="true" class="input_box">
            <img src="images/delete.jpeg">
        </p> -->
    </div>
</div>
<script>
    const createBtn = document.querySelector(".btn");
    const notes_container = document.querySelector(".notes-container");
    // let notes = document.querySelectorAll(".input_box");

    function showNotes() {
        let savedNotes = localStorage.getItem("notes");
        notes_container.innerHTML = savedNotes ? savedNotes : "";
        attachNoteEvents();
    }
    showNotes();

    function updateStorage() {
        localStorage.setItem("notes", notes_container.innerHTML);
        attachNoteEvents();
    }

    function attachNoteEvents() { //loops through each notes and attaches an input evnt listener to each note, whenvr the user types / edits, updateStorage() is called.
        document.querySelectorAll(".input_box").forEach((note) => {
            note.addEventListener("input", updateStorage);
        });
    }

    createBtn.addEventListener('click', () => {
        let note = document.createElement('p');
        let img = document.createElement("img");
        note.className = "input_box";
        note.setAttribute("contenteditable", "true");
        img.src = "images/delete.jpeg";
        note.appendChild(img);
        notes_container.appendChild(note);
        updateStorage();
        attachNoteEvents();
    })
    
    notes_container.addEventListener('click', function(e)  {
        if(e.target.tagName === "IMG") {
            e.target.parentElement.remove();
            updateStorage();
        }
    });
       
    
    document.addEventListener("keydown", event => { //We want Enter to insert a line break (<br>) instead of a new paragraph (<p>)
        if(event.key === 'Enter' && document.activeElement.contentEditable === "true") {
            // document.execCommand("insertLineBreak");
            event.preventDefault();
            document.execCommand("insertHTML", false, "<br>")
        }
    });
</script>
</body>
</html>